define(["./normalize"],function(w){function e(F,H){for(var G=0,E=F.length;G<E;G++){if(F[G]===H){return G}}return -1}if(typeof window=="undefined"){return{load:function(G,E,F){F()}}}var o=false;var l=document.getElementsByTagName("head")[0];var D=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)/);var c=false;if(!D){}else{if(D[1]||D[7]){c=parseInt(D[1])<6||parseInt(D[7])<=9;D="trident"}else{if(D[2]){c=true;D="webkit"}else{if(D[3]){}else{if(D[4]){c=parseInt(D[4])<18;D="gecko"}else{if(o){alert("Engine detection failed")}}}}}}var z={};var a=/^\/|([^\:\/]*:)/;z.pluginBuilder="./css-builder";var m=[];var q={};var f=[];z.addBuffer=function(E){if(e(m,E)!=-1){return}if(e(f,E)!=-1){return}m.push(E);f.push(E)};z.setBuffer=function(G,E){var J=window.location.pathname.split("/");J.pop();J=J.join("/")+"/";var H=require.toUrl("base_url").split("/");H.pop();var I=H.join("/")+"/";I=w.convertURIBase(I,J,"/");if(!I.match(a)){I="/"+I}if(I.substr(I.length-1,1)!="/"){I=I+"/"}z.inject(w(G,I,J));for(var F=0;F<m.length;F++){if((E&&m[F].substr(m[F].length-5,5)==".less")||(!E&&m[F].substr(m[F].length-4,4)==".css")){(function(K){q[K]=q[K]||true;setTimeout(function(){if(typeof q[K]=="function"){q[K]()}delete q[K]},7)})(m[F]);m.splice(F--,1)}}};z.attachBuffer=function(G,F){for(var E=0;E<m.length;E++){if(m[E]==G){q[G]=F;return true}}if(q[G]===true){q[G]=F;return true}if(e(f,G)!=-1){F();return true}};var g=function(E,F){setTimeout(function(){for(var H=0;H<document.styleSheets.length;H++){var G=document.styleSheets[H];if(G.href==E.href){return F()}}g(E,F)},10)};var x=function(E,F){setTimeout(function(){try{E.sheet.cssRules;return F()}catch(G){}x(E,F)},10)};if(D=="trident"&&c){var k=[],d=[],t=0;var y=function(E,G){var F;d.push({url:E,cb:G});F=k.shift();if(!F&&t++<12){F=document.createElement("style");l.appendChild(F)}j(F)};var j=function(G){var E=d.shift();if(!E){G.onload=i;k.push(G);return}G.onload=function(){E.cb(E.ss);j(G)};var F=G.styleSheet;E.ss=F.imports[F.addImport(E.url)]}}var u=function(E){var F=document.createElement("link");F.type="text/css";F.rel="stylesheet";F.href=E;return F};var i=function(){};z.linkLoad=function(F,J){var I=setTimeout(function(){if(o){alert("timeout")}J()},A*1000-100);var E=function(){clearTimeout(I);if(H){H.onload=i}setTimeout(J,7)};if(!c){var H=u(F);H.onload=E;l.appendChild(H)}else{if(D=="webkit"){var H=u(F);g(H,E);l.appendChild(H)}else{if(D=="gecko"){var G=document.createElement("style");G.textContent='@import "'+F+'"';x(G,E);l.appendChild(G)}else{if(D=="trident"){y(F,E)}}}}};var s=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"];var h={};var B=function(F,K,E){if(h[F]){K(h[F]);return}var J,G,H;if(typeof XMLHttpRequest!=="undefined"){J=new XMLHttpRequest()}else{if(typeof ActiveXObject!=="undefined"){for(G=0;G<3;G+=1){H=s[G];try{J=new ActiveXObject(H)}catch(I){}if(J){s=[H];break}}}}J.open("GET",F,requirejs.inlineRequire?false:true);J.onreadystatechange=function(M){var L,N;if(J.readyState===4){L=J.status;if(L>399&&L<600){N=new Error(F+" HTTP status: "+L);N.xhr=J;E(N)}else{h[F]=J.responseText;K(J.responseText)}}};J.send(null)};var p=0;var C;z.inject=function(E){if(p<31){C=document.createElement("style");C.type="text/css";l.appendChild(C);p++}if(C.styleSheet){C.styleSheet.cssText+=E}else{C.appendChild(document.createTextNode(E))}};var b=/@import\s*(url)?\s*(('([^']*)'|"([^"]*)")|\(('([^']*)'|"([^"]*)"|([^\)]*))\))\s*;?/g;var r=window.location.pathname.split("/");r.pop();r=r.join("/")+"/";var n=function(E,G,F){if(!E.match(a)){E="/"+w.convertURIBase(E,r,"/")}B(E,function(M){M=w(M,E,r);var J=[];var N=[];var O=[];var K;while(K=b.exec(M)){var H=K[4]||K[5]||K[7]||K[8]||K[9];J.push(H);N.push(b.lastIndex-K[0].length);O.push(K[0].length)}var I=0;for(var L=0;L<J.length;L++){(function(P){n(J[P],function(Q){M=M.substr(0,N[P])+Q+M.substr(N[P]+O[P]);var S=Q.length-O[P];for(var R=P+1;R<J.length;R++){N[R]+=S}I++;if(I==J.length){G(M)}},F)})(L)}if(J.length==0){G(M)}},F)};z.normalize=function(F,E){if(F.substr(F.length-4,4)==".css"){F=F.substr(0,F.length-4)}return E(F)};var A;var v=false;z.load=function(J,F,G,E,H){A=A||E.waitSeconds||7;var I=J+(!H?".css":".less");if(z.attachBuffer(I,G)){return}fileUrl=F.toUrl(I);if(!v&&o){alert(c?"hacking links":"not hacking");v=true}if(!H){z.linkLoad(fileUrl,G)}else{n(fileUrl,function(K){if(H){K=H(K,function(L){z.inject(L);setTimeout(G,7)})}})}};if(o){z.inspect=function(){if(stylesheet.styleSheet){return stylesheet.styleSheet.cssText}else{if(stylesheet.innerHTML){return stylesheet.innerHTML}}}}return z});